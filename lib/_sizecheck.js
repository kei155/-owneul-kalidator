"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),TesterNotFoundError=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(Error),InvalidRuleError=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(Error),InvalidValueError=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(Error),is={empty:function(e){return!e||null===e||""===e||e instanceof FileList&&0===e.length},number:function(e){return!isNaN(e)},file:function(e,t,r){if(void 0===t&&(t=""),!(e instanceof File))return!1;if("*/*"!==t){var i=t.match(/(.*\/)\*/);if(i){if(0!==e.type.indexOf(i[1]))return!1}else if(""!==t&&e.type!==t)return!1}if(r=Array.isArray(r)?r:[r],!is.empty(r)){var n=e.name.split(".");if(n.length>0){var a=n[n.length-1];if(-1===r.indexOf(a))return!1}}return!0}},Validator=function(){function e(e,t,r){var i=this;this.data={},this.rules={},this.unlabeledRules={},this.requiredKeys=[],this.customTesterCount=0,this.messages={},this.errors={},this.isPassed=!1,this.is=is,this.defaults={messages:{required:":param(은/는) 필수입력사항입니다.",minLength:":param(은/는) 최소 :$0자를 입력해야합니다.",maxLength:":param(은/는) 최대 :$0자까지 입력할 수 있습니다.",betweenLength:":param(은/는) :$0자 ~ :$1자 사이에서 입력할 수 있습니다.",minValue:":param의 값은 최소 :$0입니다.",maxValue:":param의 값은 최대 :$0입니다.",betweenValue:":param의 값은 :$0 ~ :$1 사이만 가능합니다.",in:":param의 값은 :$concat 중 하나여야합니다.",notIn:":param의 값은 :$concat 이외의 값이어야합니다.",number:":param의 값은 숫자여야합니다.",email:":param의 값은 유효한 이메일 주소여야합니다.",date:":param의 값은 날짜여야합니다.",file:":param 파일이 정상적으로 첨부되지 않았습니다."}},this.tester={required:function(e,t,r){return void 0===t&&(t=null),void 0===r&&(r={}),!is.empty(r[e])},minLength:function(e,t,r){return void 0===r&&(r={}),is.number(r[e])&&r[e].length>=t},maxLength:function(e,t,r){return void 0===r&&(r={}),is.number(r[e])&&r[e].length<=t},betweenLength:function(e,t,r){if(void 0===r&&(r={}),!t[0]||!t[1])throw new InvalidRuleError("Rule betweenLength has invalid format(format: 'betweenLength:min,max')");return i.tester.minLength(e,t[0],r)&&i.tester.maxLength(e,t[1],r)},minValue:function(e,t,r){if(void 0===r&&(r={}),!t)throw new InvalidRuleError("Rule minValue has invalid format(format: 'minValue:min')");if(isNaN(t))throw new InvalidValueError("Invalid value detected(minValue testing value must be number. "+t+" is not a number)");return is.number(r[e])&&r[e]>=t},maxValue:function(e,t,r){if(void 0===r&&(r={}),!t)throw new InvalidRuleError("Rule maxValue has invalid format(format: 'maxValue:max')");if(isNaN(t))throw new InvalidValueError("Invalid value detected(maxValue testing value must be number. "+t+" is not a number)");return is.number(r[e])&&r[e]<=t},betweenValue:function(e,t,r){if(void 0===r&&(r={}),!t[0]||!t[1])throw new InvalidRuleError("Rule betweenValue has invalid format(format: 'betweenValue:min,max')");return is.number(r[e])&&i.tester.minValue(e,t[0],r)&&i.tester.maxValue(e,t[1],r)},in:function(e,t,r){if(void 0===r&&(r={}),!t)throw new InvalidRuleError("Rule in has invalid format(format: 'in:a,b,c...')");return-1!=(t=Array.isArray(t)?t:[t]).indexOf(r[e])},notIn:function(e,t,r){if(void 0===r&&(r={}),!t)throw new InvalidRuleError("Rule notIn has invalid format(format: 'notIn:a,b,c...')");return-1===(t=Array.isArray(t)?t:[t]).indexOf(r[e])},number:function(e,t,r){return void 0===r&&(r={}),is.number(r[e])},email:function(e,t,r){if(void 0===r&&(r={}),"string"!=typeof r[e])throw new InvalidValueError("Invalid value detected(email testing value must be string. "+[r[e]]+" is not a string)");return r[e].match(/@/g)&&1===r[e].match(/@/g).length&&"@"!==r[e][0]&&"@"!==r[e][r[e].length-1]},date:function(e,t,r){return void 0===r&&(r={}),!isNaN(Date.parse(r[e]))},file:function(e,t,r){void 0===r&&(r={});var i=Array.isArray(t)?t[0]:t,n=Array.isArray(t)?t.slice(1):[],a=!0;if(r[e]instanceof FileList)for(var s=0;s<r[e].length;s++){var o=r[e][s];a=a&&is.file(o,i,n)}else a=r[e]instanceof File&&is.file(r[e],i,n);return a}},this.setData(e),this.setRules(t),this.setMessages(r)}return e.prototype.__isRequired=function(e){return-1!=this.requiredKeys.indexOf(e)},e.prototype.applyZosa=function(e){for(var t=e,r=["(은/는)","(이/가)","(을/를)","(과/와)","(아/야)","(이여/여)","(이랑/랑)","(으로/로)","(으로서/로서)","(으로써/로써)","(으로부터/로부터)"],i=0;i<r.length;i++){var n=r[i];if(-1!==e.indexOf(n)){var a=e.charCodeAt(e.indexOf(n)-1)-44032;(a>=0||a<=11171)&&(t=t.replace(n,a%28!=0?n.split("/")[0].replace("(",""):n.split("/")[1].replace(")","")))}}return t},e.prototype.test=function(e,t){var r=e,i=null;if(-1!==r.indexOf("(")&&-1!==r.indexOf(")")){var n=r.split("(");r=n[0],i=n[1].substring(0,n[1].length-1)}var a=t,s="";if(-1!==a.indexOf(":")){var o=a.split(":");a=o[0],s=-1!==o[1].indexOf(",")?o[1].split(","):o[1]}var u=this.tester[a];if(!u)throw new TesterNotFoundError("Tester ["+a+"] Not Found.");if((this.__isRequired(r)||!is.empty(this.data[r]))&&!u(r,s,this.data)){var l=(this.messages[r+"."+a]||this.defaults.messages[a]||"").replace(":param",i||r).replace(":$concat","["+(Array.isArray(s)?s.join(", "):s)+"]");Array.isArray(s)?s.forEach(function(e,t){l=l.replace(":$"+t,e)}):l=l.replace(":$0",s),this.errors[r]=this.errors[r]||{},this.errors[r][a]=this.applyZosa(l)}},e.prototype.setData=function(e){var t=this;if(this.data={},e instanceof FormData)e.forEach(function(e,r){t.data[r]=e});else if(e instanceof HTMLElement)for(var r=e.querySelectorAll("[name]"),i=0;i<r.length;i++){var n=r[i],a=n.getAttribute("type"),s=n.getAttribute("name")||"noname";n instanceof HTMLInputElement?"radio"==a&&n.checked?this.data[s]=n.value:"file"==a?n.files&&1===n.files.length?this.data[s]=n.files[0]:n.files&&(this.data[s]=n.files):this.data[s]=n.value:n instanceof HTMLSelectElement&&(this.data[s]=n.value)}else if("object"==typeof e)for(var o in e)if(e.hasOwnProperty(o)){var u=e[o];this.data[o]=u}return this},e.prototype.setRules=function(e){if(this.rules={},e)for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];this.setRule(t,r)}return this},e.prototype.setRule=function(e,t){var r=e;(this.rules[e]=t,-1!==e.indexOf("(")&&-1!==e.indexOf(")"))&&(r=e.split("(")[0]);return this.unlabeledRules[r]=t,-1!=t.indexOf("required")&&this.requiredKeys.push(r),this},e.prototype.setMessages=function(e){if(this.messages={},e)for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];this.setMessage(t,r)}return this},e.prototype.setMessage=function(e,t){return this.messages[e]=t,this},e.prototype.registTester=function(e,t){return this.tester[e]=t,this},e.prototype.run=function(e){for(var t in this.rules)if(this.rules.hasOwnProperty(t))for(var r=this.rules[t],i=0;i<r.length;i++){var n=r[i];this.test(t,n)}this.isPassed=0===Object.keys(this.errors).length&&JSON.stringify(this.errors)===JSON.stringify({}),this.isPassed&&e&&e.success?e.success():!this.isPassed&&e&&e.fail&&e.fail(this.errors)},e}();module.exports=Validator;